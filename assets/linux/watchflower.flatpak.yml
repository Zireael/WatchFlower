app-id: io.emeric.watchflower
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
command: watchflower

rename-desktop-file: watchflower.desktop
rename-appdata-file: watchflower.appdata.xml
rename-icon: watchflower

finish-args:
  # Our UI is GPU accelerated
  - --device=dri
  # X11 + XShm access
  - --share=ipc
  - --socket=fallback-x11
  # Wayland access
  - --socket=wayland
  # We need Bluetooth support
  - --allow=bluetooth
  - --system-talk-name=org.bluez
  - --share=network

cleanup:
- /bin/__pypache__
- /bin/rst*
- /include
- /lib/cmake
- /lib/cups
- /lib/pkgconfig
- /lib/python*
- /share/doc
- /share/man
- /share/zsh
- /src
- '*.a'
- '*.la'

build-options:
  append-ld-library-path: /app/lib

modules:

- name: bluez # required by qtconnectivity
  buildsystem: autotools
  config-opts:
    - --disable-tools
    - --disable-cups
    - --disable-monitor
    - --disable-client
    - --disable-systemd
    - --disable-udev
    - --disable-manpages
    - --disable-datafiles
    - --enable-experimental
    - --enable-library
    - --prefix=/app
    - --sysconfdir=/app/etc
  sources:
    - type: archive
      url: https://www.kernel.org/pub/linux/bluetooth/bluez-5.64.tar.xz
      sha256: ae437e65b6b3070c198bc5b0109fe9cdeb9eaa387380e2072f9de65fe8a1de34
      x-checker-data:
        type: anitya
        project-id: 10029
        url-template: https://www.kernel.org/pub/linux/bluetooth/bluez-$version.tar.xz

- name: qt-base
  buildsystem: cmake-ninja
  builddir: true
  config-opts:
    - -DQT_BUILD_EXAMPLES=OFF
    - -DQT_BUILD_TESTS=OFF
  sources:
    - type: archive
      url: https://download.qt.io/official_releases/qt/6.3/6.3.0/submodules/qtbase-everywhere-src-6.3.0.tar.xz
      sha256: b865aae43357f792b3b0a162899d9bf6a1393a55c4e5e4ede5316b157b1a0f99
  cleanup:
    - /bin

- name: qt-tools
  buildsystem: cmake-ninja
  builddir: true
  config-opts:
    - -DCMAKE_PREFIX_PATH=/app
    - -DQT_BUILD_EXAMPLES=OFF
    - -DQT_BUILD_TESTS=OFF
  sources:
    - type: archive
      url: https://download.qt.io/official_releases/qt/6.3/6.3.0/submodules/qttools-everywhere-src-6.3.0.tar.xz
      sha256: fce94688ea925782a2879347584991f854630daadba6c52aed6d93e33cd0b19c

- name: qt-shadertools
  buildsystem: cmake-ninja
  builddir: true
  config-opts:
    - -DQT_BUILD_EXAMPLES=OFF
    - -DQT_BUILD_TESTS=OFF
  sources:
    - type: archive
      url: https://download.qt.io/official_releases/qt/6.3/6.3.0/submodules/qtshadertools-everywhere-src-6.3.0.tar.xz
      sha256: 5498959b9d37c254bd126ab1320cf86aeb8a31b3ea7e51db666a8f9698afbd6c

- name: qtdeclarative
  buildsystem: cmake-ninja
  builddir: true
  config-opts:
    - -DCMAKE_PREFIX_PATH=/app
    - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    - -DQT_BUILD_EXAMPLES=OFF
    - -DQT_BUILD_TESTS=OFF
  sources:
    - type: archive
      url: https://download.qt.io/official_releases/qt/6.3/6.3.0/submodules/qtdeclarative-everywhere-src-6.3.0.tar.xz
      sha256: d294b029dc2b2d4f65da516fdc3b8088d32643eb7ff77db135a8b9ce904caa37

- name: qtwayland
  buildsystem: cmake-ninja
  config-opts:
    - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    - -DQT_BUILD_EXAMPLES=OFF
    - -DQT_BUILD_TESTS=OFF
  sources:
    - type: archive
      url: https://download.qt.io/official_releases/qt/6.3/6.3.0/submodules/qtwayland-everywhere-src-6.3.0.tar.xz
      sha256: e7b567f6e43ffc5918d4aa825ce1eced66a00cb0a87133b2912ba5c1b2a02190
  cleanup:
    - /bin

- name: qtimageformats
  buildsystem: cmake-ninja
  config-opts:
    - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    - -DQT_BUILD_EXAMPLES=OFF
    - -DQT_BUILD_TESTS=OFF
  sources:
    - type: archive
      url: https://download.qt.io/official_releases/qt/6.3/6.3.0/submodules/qtimageformats-everywhere-src-6.3.0.tar.xz
      sha256: 025d0d17ed75b42a7eb6b523731ab8f17025421a8810cade25caffe05d93abef

- name: qtsvg
  buildsystem: cmake-ninja
  config-opts:
    - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    - -DQT_BUILD_EXAMPLES=OFF
    - -DQT_BUILD_TESTS=OFF
  sources:
    - type: archive
      url: https://download.qt.io/official_releases/qt/6.3/6.3.0/submodules/qtsvg-everywhere-src-6.3.0.tar.xz
      sha256: 3164504d7e3f640439308235739b112605ab5fc9cc517ca0b28f9fb93a8db0e3

- name: qtconnectivity
  buildsystem: cmake-ninja
  config-opts:
    - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    - -DQT_BUILD_EXAMPLES=OFF
    - -DQT_BUILD_TESTS=OFF
  sources:
    - type: archive
      url: https://download.qt.io/official_releases/qt/6.3/6.3.0/submodules/qtconnectivity-everywhere-src-6.3.0.tar.xz
      sha256: 98f7132e3aa56db2be4800897a0514248a7ae83791b69f8162d628e187b0e61a

- name: qtcharts
  buildsystem: cmake-ninja
  config-opts:
    - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    - -DQT_BUILD_EXAMPLES=OFF
    - -DQT_BUILD_TESTS=OFF
  sources:
    - type: archive
      url: https://download.qt.io/official_releases/qt/6.3/6.3.0/submodules/qtcharts-everywhere-src-6.3.0.tar.xz
      sha256: 672762c5f641ccc88a30aeedefb63f03c0f837649b334f46eea57592e87e36cd

- name: qt5compat
  buildsystem: cmake-ninja
  config-opts:
    - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    - -DQT_BUILD_EXAMPLES=OFF
    - -DQT_BUILD_TESTS=OFF
  sources:
    - type: archive
      url: https://download.qt.io/official_releases/qt/6.3/6.3.0/submodules/qt5compat-everywhere-src-6.3.0.tar.xz
      sha256: 2b199be780c50d9214512b922d94cb240b0412fd63f459e356b76102cad1713e

- name: watchflower
  buildsystem: qmake
  sources:
    - type: archive
      url: https://github.com/emericg/WatchFlower/archive/refs/tags/v4.0.tar.gz
